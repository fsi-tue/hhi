<!DOCTYPE html>
<html>
    <head>
        <title>
            FSI HHI
        </title>
        <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
        <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
        <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/siimple-icons/siimple-icons.css" />
        <link rel="stylesheet" href="style.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />

        <script type="text/javascript">
            function showRegistrationDialog(task, shift) {
                document.getElementById("registration-task").innerHTML = task;
                document.getElementById("input-task").value = task;
                document.getElementById("registration-shift").innerHTML = shift;
                document.getElementById("input-shift").value = shift;
                document.getElementById("modal-registration").classList.add("active");
                document.getElementById("input-name").focus();
            }

            function hideRegistrationDialog() {
                document.getElementById("modal-registration").classList.remove("active");
            }
        </script>
    </head>
    <body>
        <header class="navbar">
            <section class="navbar-section">
                <span class="hhi-logo">
                    <span class="hhi-logo-first">H</span>elfilisten<br/>
                    <span class="hhi-logo-first">H</span>osting<br/>
                    <span class="hhi-logo-first">I</span>nterface
                </span>
            </section>
            <section class="navbar-section">
                <span class="fsi-logo">fsi</span>
            </section>
        </header>
        
        <div class="text-center event-info">
            <h1>
                <?=$eventInfo["eventName"]?>
            </h1>
            <div class="columns col-gapless">
                <div class="column col-4 col-md-3 text-right">
                    <i style="font-size: 200%" class="si-calendar"></i>
                </div>
                <div class="column col-4 col-md-8 text-center">
                    <?=$eventInfo["eventDate"]?>
                </div>
            </div>
            <div class="divider"></div>
            <div class="columns col-gapless">
                <div class="column col-4 col-md-3 text-right">
                    <i style="font-size: 200%" class="si-info-circle"></i>
                </div>
                <div class="column col-4 col-md-8 text-center">
                    <?=$eventInfo["eventDesc"]?>
                </div>
            </div>
        </div>

        <div class="text-center toast-info">
        <?php if(isset($toast)) { ?>
            <div class="toast toast-<?=$toast["style"]?>">
                <?=$toast["message"]?>
            </div>
        <?php } ?>
        </div>

        <section>
            <?php foreach($eventInfo["eventTasks"] as $task) { ?>
            <div class="accordion accordion-shift">
                <input type="checkbox" id="accordion-<?=md5($task["taskName"])?>" name="accordion-checkbox" hidden>
                <label class="accordion-header" for="accordion-<?=md5($task["taskName"])?>">
                    <h3 class="c-hand">
                        <i class="icon icon-arrow-right mr-1"></i> 
                        <i class="icon icon-location"></i> 
                        <?=$task["taskName"]?>
                        <span class="chip chip-occupancy" style="background: <?=$task["occupancyColor"]?>"><?=$task["occupancyString"]?></span>
                    </h3>
                </label>
                <div class="accordion-body">
                    <div class="text-italic shift-desc">
                        <?=$task["taskDesc"]?>
                    </div>
                    <?php foreach($task["taskShifts"] as $shift) { ?>
                        <div class="accordion accordion-slot">
                            <input type="checkbox" id="accordion-<?=md5($task["taskName"] . $shift["shiftName"]) . (isset($shift["shiftDesc"]) ? $shift["shiftDesc"] : "")?>" name="accordion-checkbox" hidden>
                            <label class="accordion-header c-hand" for="accordion-<?=md5($task["taskName"] . $shift["shiftName"]) . (isset($shift["shiftDesc"]) ? $shift["shiftDesc"] : "")?>">
                                <h5 class="c-hand">
                                    <i class="icon icon-arrow-right mr-1"></i>
                                    <i class="icon icon-time mr-1"></i>
                                    <?=$shift["shiftName"]?> 
                                    <?=isset($shift["shiftDesc"]) ? "<small class='chip bg-primary'>".$shift["shiftDesc"]."</small>" : ""?>
                                    <span class="chip chip-occupancy" style="background: <?=$shift["occupancyColor"]?>"><?=$shift["occupancyString"]?></span>
                                </h5>
                            </label>
                            <div class="accordion-body">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Nr.</th>
                                            <th>Name</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    <?php for($i = 0; $i < $shift["shiftSlots"]; $i++) { ?>
                                        <tr>
                                            <td><?=$i+1?></td>
                                            <td><?=isset($shift["entries"][$i]) ? $shift["entries"][$i]["entryName"] : "<i>leer</i>"?></td>
                                        </tr>
                                    <?php } ?>
                                    </tbody>
                                </table>
                                <?php if( !isset($shift["entries"]) || count($shift["entries"]) < $shift["shiftSlots"]) { ?>  
                                <a href="javascript:showRegistrationDialog('<?=$task["taskName"]?>', '<?=$shift["shiftName"]?>')" 
                                    class="btn btn-primary btn-register">Hier eintragen</a>
                                <?php } ?>
                            </div>
                        </div>
                    <?php } ?>
                </div>
            </div>

            <?php } ?>
        </section>
        <div class="modal" id="modal-registration">
            <a href="javascript:hideRegistrationDialog()" class="modal-overlay" aria-label="Close"></a>
            <div class="modal-container">
                <div class="modal-header">
                <a href="javascript:hideRegistrationDialog()" class="btn btn-clear float-right" aria-label="Close"></a>
                <div class="modal-title h5">In Schicht eintragen</div>
                </div>
                <div class="modal-body">
                    <div class="content">
                        <div class="text-center">
                            Vielen Dank für Deine Hilfe! <i class="si-heart"></i>
                        </div>
                        <div class="text-center">
                            <b>Aufgabe:</b> <span id="registration-task"></span><br/>
                            <b>Schicht:</b> <span id="registration-shift"></span><br/>
                        </div>
                        <form method="POST" id="form-register" class="form-horizontal">
                            <input type="hidden" name="action" value="register" />
                            <input type="hidden" id="input-task" name="data-task" value="" />
                            <input type="hidden" id="input-shift" name="data-shift" value="" />
                            <div class="form-group">
                                <div class="col-3 col-sm-12">
                                    <label class="form-label" for="input-name">Dein Name:</label>
                                </div>
                                <div class="col-9 col-sm-12">
                                    <input class="form-input" type="text" id="input-name" name="data-name" placeholder="fachschaft.name">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-3 col-sm-12">
                                    <div class="popover">
                                        <label class="form-label" for="input-zxnick">Dein ZX-Kürzel: <i class="si-question-circle"></i></label>
                                        <div class="popover-container popover-zxnick">
                                            <div class="card">
                                                <div class="card-header text-tiny">
                                                    <b>Wofür benötigen wir Dein ZX-Kürzel?</b>
                                                </div>
                                                <div class="card-body text-tiny">
                                                    Wir benötigen Dein ZX-Kürzel lediglich, um Dir eine Mail an Deine studentische
                                                    Mailadresse zu senden. Nach der Veranstaltung wird das ZX-Kürzel natürlich sofort
                                                    wieder gelöscht und von uns nicht anderweitig benutzt. 
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="col-9 col-sm-12">
                                    <input class="form-input" type="text" id="input-zxnick" name="data-zxnick" placeholder="zxabc12">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="columns">
                        <div class="col-6 text-center">
                            <a href="javascript:hideRegistrationDialog()" class="btn btn-primary">Abbrechen</a>
                        </div>
                        <div class="col-6 text-center">
                            <a href="javascript:document.getElementById('form-register').submit()" class="btn btn-primary">Eintragen</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="navbar footer">
            <section class="navbar-section footer-left">
                <a href="https://github.com/fsi-tue/hhi">Source Code on GitHub</a>
            </section>
            <section class="navbar-section footer-right">
                &copy; 2025
                <?=$authors?>
            </section>
        </footer>
    </body>
</html>